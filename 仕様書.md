# 仕様書：インタラクティブ・セクターローテーション・ダッシュボード (Python単体構成)

## 1. 概要

本プロジェクトは、1〜2週間の短期的な日本株セクターローテーション分析を支援するための、インタラクティブなWebダッシュボードを開発する。
ユーザーはベンチマーク（TOPIX/日経225）を選択し、チャート上で過去の日付を直感的に指定することで、その時点でのセクターの強弱をRRG（Relative Rotation Graph）や各種データで確認できる。

## 2. システムアーキテクチャ

本ダッシュボードは、クライアント・サーバーモデルに基づいたシンプルな2層構造で実装する。

* **フロントエンド (JavaScript)**: ブラウザ上で動作し、UIの描画とユーザー操作の受付を担当。バックエンド(Python)にAPIリクエストを送信する。
* **バックエンド (Python / FastAPI)**: フロントエンドからのAPIリクエストに応じてデータ計算を行い、結果をJSONで返す。同時に、HTML/CSS/JSといった静的ファイルの配信も担当する。

---

## 3. コンポーネント別仕様

### 3.1. フロントエンド (JavaScript)

ブラウザ上で動作するシングルページアプリケーション(SPA)として実装する。

#### **3.1.1. UIコンポーネント**

1.  **コントロール・パネル**:
    * **ベンチマーク選択 (Dropdown)**: `TOPIX`と`日経225`を選択可能。選択肢が変更されたら、バックエンドにAPIリクエストを再送信する。
2.  **メインパネル**:
    * **ローソク足チャート (Plotly.js等)**: 選択されたベンチマークの時系列データを表示。ドラッグによる範囲選択機能を実装する。範囲が選択されたら、その最終日を基準にAPIリクエストを再送信する。
3.  **分析パネル**:
    * **RRGチャート (Plotly.js, ECharts等)**: APIから取得したデータを基に描画。表示/非表示セクターの選択に応じて再描画する。
    * **ロング/ショート候補リスト (HTML Table)**: APIデータに基づき、条件に合うセクターをリスト表示。
    * **全セクターデータ一覧 (HTML Table)**: APIデータに基づき全セクターの情報を表示。先頭列にチェックボックスを設け、RRGチャートの表示/非表示を制御する。

#### **3.1.2. 状態管理**

* `benchmark`: 現在選択中のベンチマーク (`1306.T` or `1321.T`)
* `targetDate`: メインチャートで選択された日付 (`YYYY-MM-DD`)
* `visibleSectors`: 表示対象セクターのティッカーリスト
* `dashboardData`: APIから取得した全データ

これらの状態が変更されるたびに、関連するUIコンポーネントが再描画される。

### 3.2. バックエンド (Python / FastAPI)

`FastAPI`と`Uvicorn`をベースとしたWebアプリケーションサーバーを構築する。

#### **3.2.1. 役割**

1.  **静的ファイルの配信**: ルートパス(`/`)へのアクセスに対し、`./static`ディレクトリ配下の`index.html`や関連するCSS/JSファイルを配信する。
2.  **APIの提供**: フロントエンドからのデータ要求に応じ、リアルタイムでRRG指標等を計算してJSON形式で提供する。

#### **3.2.2. APIエンドポイント**

* **`GET /calculate`**: RRG指標とベンチマークの株価データを計算する。
    * **クエリパラメータ**:
        * `benchmark_ticker` (string, 必須)
        * `date` (string, 必須)
    * **処理**:
        1.  `yfinance`を使い、全セクターと指定されたベンチマークの過去株価データを取得する。
        2.  指定された`date`を基準点として、短期設定のパラメータで全セクターのRS-Ratio, RS-Momentum, 軌跡データ等を`pandas`で計算する。
        3.  計算結果と、メインチャート表示用のベンチマークのローソク足データをJSON形式で整形してレスポンスとして返す。

---

## 4. APIレスポンス形式 (JSON)

Pythonサーバーがフロントエンドに返却するJSONデータの構造定義。

```json
{
  "benchmark_ohlc": [
    {
      "date": "2025-08-25",
      "open": 6450.10,
      "high": 6480.20,
      "low": 6440.00,
      "close": 6475.50
    }
  ],
  "sectors": [
    {
      "name": "食品",
      "ticker": "1617.T",
      "rs_ratio": 102.5,
      "rs_momentum": 101.8,
      "quadrant": "Leading",
      "weekly_change_pct": 2.5,
      "tail": [
        [102.1, 101.2],
        [102.2, 101.4],
        [102.5, 101.8]
      ]
    }
  ]
}